<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan System Center Support Blog</title>
  
  <subtitle>日本マイクロソフトの System Center に関するサポート情報のブログです。</subtitle>
  <link href="https://jpsystemcenter.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpsystemcenter.github.io/blog/"/>
  <updated>2022-08-03T07:36:22.288Z</updated>
  <id>https://jpsystemcenter.github.io/blog/</id>
  
  <author>
    <name>Japan System Center Support</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SCOM 2019 以降で Windows 検出ウィザードで検出失敗</title>
    <link href="https://jpsystemcenter.github.io/blog/SCOM/SCOM_service_logon_access/"/>
    <id>https://jpsystemcenter.github.io/blog/SCOM/SCOM_service_logon_access/</id>
    <published>2022-08-03T06:00:00.000Z</published>
    <updated>2022-08-03T07:36:22.288Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは、System Center サポートチームの 佐藤 です。</p><p>本日は System Center Operations Manager（以後 SCOM）  2019 で変更のあった仕様の 1 つをご紹介いたします。<br>2022 年 8 月現在の状況として、（<a href="https://docs.microsoft.com/ja-jp/lifecycle/products/microsoft-system-center-2012-r2-operations-manager">SCOM 2012 R2の延長サポートのフェーズが2022年7月に終了</a>）したことに伴い、SCOM 2019 や 2022 など後継バージョンの環境を新規構築して移行を進めている、もしくはご計画されているお客様もいるかと存じます。</p><p>SCOM 2019 の新規環境を構築後に Windows コンピューターを検出する際に SCOM インストール ユーザ以外で検出を試みると下図のエラー（対象コンピューターがいない）と出力される場合がございます。</p><p><img src="img/SCOM_detection_computer_failures.png"></p><p>この事象はこれまでのバージョンと異なり検出する実行アカウントに対しててサービス ログオンアクセス許可を有効にいない場合に発生している可能性がございます。<br>設定をされていなければ、下記手順にて一度設定をいただき、事象がfai改善するかご確認いただければと存じます。</p><p>SCOM 管理サーバーにて以下設定をする事で、サービス ログオンアクセス許可を有効にできます。</p><ol><li>SCOM 管理サーバーに管理者特権でサインインします。</li><li>[管理ツール] に移動し、 [ローカル セキュリティ ポリシー] をクリックします。<br>　例えば、Windows Server 2016 以降では、スタートメニューを開き、[Windows 管理ツール] -&gt; [ローカル セキュリティ ポリシー] をクリックします。</li><li>[ローカル ポリシー] を展開し、 [ユーザー権利の割り当て] をクリックします。</li><li>右側のウィンドウで、 [サービスとしてログオン] を右クリックし、 [プロパティ] を選択します。</li><li>[ユーザーまたはグループの追加] オプションをクリックし、以下どちらかを追加します。</li><li>サーバーを再起動します。</li></ol><p>参考サイト：<a href="https://docs.microsoft.com/ja-jp/system-center/scom/enable-service-logon?view=sc-om-2019#enable-service-log-on-permission-for-run-as-accounts">https://docs.microsoft.com/ja-jp/system-center/scom/enable-service-logon?view=sc-om-2019#enable-service-log-on-permission-for-run-as-accounts</a></p><blockquote><p>対象バージョン：<br>　System Center Operations Manager 2019<br>　System Center Operations Manager 2022</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは、System Center サポートチームの 佐藤 です。&lt;/p&gt;
&lt;p&gt;本日は System Center Operations Manager（以後 SCOM）  2019 で変更のあった仕様の 1 つをご</summary>
      
    
    
    
    
    <category term="SCOM" scheme="https://jpsystemcenter.github.io/blog/tags/SCOM/"/>
    
    <category term="Troubleshoot" scheme="https://jpsystemcenter.github.io/blog/tags/Troubleshoot/"/>
    
  </entry>
  
  <entry>
    <title>SCVMM ジョブ保存設定変更方法</title>
    <link href="https://jpsystemcenter.github.io/blog/SCVMM/SCVMM_Job_History/"/>
    <id>https://jpsystemcenter.github.io/blog/SCVMM/SCVMM_Job_History/</id>
    <published>2022-07-07T03:00:00.000Z</published>
    <updated>2022-08-03T07:36:22.292Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆さんこんにちは、System Center サポートチームの 保科と申します。</p><p>今回は、System Center Virtual Machine Manager (SCVMM) で保存されるジョブ履歴の保存設定についてご紹介いたします。</p><h3 id="本ページが対象とする-SCVMM-バージョン"><a href="#本ページが対象とする-SCVMM-バージョン" class="headerlink" title="[本ページが対象とする SCVMM バージョン]"></a>[本ページが対象とする SCVMM バージョン]</h3><p>SCVMM 2016<br>SCVMM 2019<br>SCVMM 2022</p><h3 id="概要"><a href="#概要" class="headerlink" title="[概要]"></a>[概要]</h3><p>SCVMM で実行される処理の多くは、ジョブという形で実行されます。<br>このジョブが実行されると、実行可否に関わらず、履歴としてすべて SCVMM データベースに存在する [dbo].[tbl_TR_TaskTrail] というテーブルに保存されます。<br>ジョブ履歴ですが、バッチ処理を組まれる等して大量のジョブが短期間で実行される環境においては、このテーブルが肥大化する要因となります。<br>テーブルが肥大化することで、SCVMM 観点においては下記の影響が発生します。</p><ul><li>単純に [dbo].[tbl_TR_TaskTrail] テーブルサイズが肥大化し、データベースファイルサイズの肥大化</li><li>SCVMM へのパフォーマンスへの影響</li></ul><p>意外に思われるかもしれませんが、ジョブ履歴が大量に保存されている環境においては、SCVMM へのパフォーマンス影響が発生する可能性がございます。<br>特段負荷が大きい処理を連続して実施されていないにも関わらず、SCVMM ジョブの実行速度や SCVMM 自体が以前より遅くなったといった状況では、ジョブ履歴が大量に保存されている可能性がございます。</p><h3 id="対処手順"><a href="#対処手順" class="headerlink" title="[対処手順]"></a>[対処手順]</h3><p>このジョブ履歴ですが、レジストリ値によってジョブ履歴保持日数および削除処理が行われる周期を設定いただけます。<br>そのため、”概要” 項で説明しました影響が発生されている場合は、そのレジストリ値設定を変更いただくのが切り分けとして有用となります。</p><p>追加いただくレジストリは、以下の 2 種類が該当いたします。</p><blockquote><p>レジストリキー:<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft System Center Virtual Machine Manager Server\Settings\Sql</p><p>レジストリの種類:<br>DWORD (32 ビット) 値</p><p>レジストリの名称:<br>TaskGC</p><p>レジストリ値:<br>ジョブの保持日数を整数値で指定します。<br>例えば、本レジストリ値が 7 に設定された場合、ジョブ履歴削除処理が行われた日付時刻から 7 日以内のジョブは保持され、それ以外はすべて削除対象となります。<br>レジストリが未作成の状態である場合、本レジストリ値は 90 に設定されたものとして動作が行われます。<br>こちらのレジストリ設定値を、ご利用の環境でどの程度ジョブ履歴を重要視されるかに応じて設定します。<br>また、本レジストリ値の設定値に関わらず、一度のジョブ履歴削除処理で削除されるジョブ数は最大で 50000 件となります。<br>そのため、各処理間で 50000 件以上のジョブ履歴が保存される場合、ジョブ履歴は傾向として増加される状況となります。<br>ご利用の環境に合わせて、もう一つのレジストリである “DBGCUpdateInterval” のレジストリ値を構成します。</p></blockquote><blockquote><p>レジストリキー:<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft System Center Virtual Machine Manager Server\Settings</p><p>レジストリの種類:<br>DWORD (32 ビット) 値</p><p>キーの名称 :<br>DBGCUpdateInterval</p><p>レジストリ値:<br>ジョブ削除ジョブが実行される周期を秒単位の整数値で指定します。<br>レジストリが未作成の状態である場合、本レジストリ値は 72000 (= 20 時間) に設定されたものとして動作が行われます。</p></blockquote><p>レジストリの作成は、下記手順で行えます。</p><ol><li>レジストリを追加する SCVMM サーバーに管理者権限でログインします。</li><li>[Win] + [R] キーを押下し、”regedit” と入力して実行します。</li><li>画面左ペインより、各レジストリの追加先となるレジストリキーにアクセスします。</li><li> レジストリが表示された画面上で右クリックし、[新規] -&gt; [DWORD (32 ビット) 値] をクリックします。</li><li>追加されたレジストリに対して、”キーの名称” で指定された文字列を入力します。</li><li>追加されたレジストリをダブルクリックし、レジストリの編集を行います。</li><li>ウィンドウ右側に表示された [10 進数] を選択し、レジストリで指定いただく値を入力します。</li><li>レジストリ追加完了後、SCVMM サーバーに関するサービスである “System Center Virtual Machine Manager” サービスを再起動します。</li></ol><h3 id="ご参考"><a href="#ご参考" class="headerlink" title="[ご参考]"></a>[ご参考]</h3><p>既に弊社にて公開がされていないサイトとなりますので、こちらのブログにて併せてそちらのサイトの内容をご紹介いたします。<br>その公開終了されたサイトでは、SCVMM のジョブについて要約すると以下の内容が書かれておりました。</p><ul><li>SCVMM の仕様として、目安ではあるものの 10000 の同時並行実施ジョブが処理可能であること。</li><li>10000 以上のジョブが同時並行で実施されている場合、SCVMM サーバーのパフォーマンスに多大な影響を及ぼす可能性があること。</li><li>大量のジョブが並行実施される動作とは別に、SCVMM ジョブ履歴が大量に保存されている場合、それによっても SCVMM サーバーのパフォーマンスに多大な影響を及ぼす可能性があること。</li></ul><p>公開終了とされる前に記載されております内容について、原文のままご紹介いたします。</p><ul><li><p>SCVMM で同時並行で実行可能なジョブ数に関する記述:</p><blockquote><p>The maximum number of running jobs that an SCVMM system should be able to handle is around 10,000 and hitting this many running jobs at one time would be an exceptionally rare occurrence.<br>Should it occur, however, it can have a severe impact on the performance of the SCVMM engine.</p></blockquote></li><li><p>SCVMM ジョブ履歴が大量に保存されていることで発生しうる影響に関する記述:</p><blockquote><p>The number of retained Jobs count refers to the number of running tasks tracked in the TaskTrail database table in SQL.<br>The size of this database can have as much of an impact on performance as the actual running jobs.<br>If the number of running jobs nowhere reaches 10,000 then it may be that the tombstone limit on entries tracked in the TaskTrail database is too conservative</p></blockquote></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆さんこんにちは、System Center サポートチームの 保科と申します。&lt;/p&gt;
&lt;p&gt;今回は、System Center Virtual Machine Manager (SCVMM) で保存されるジョブ履歴の保存設</summary>
      
    
    
    
    
    <category term="SCVMM" scheme="https://jpsystemcenter.github.io/blog/tags/SCVMM/"/>
    
    <category term="HowTo" scheme="https://jpsystemcenter.github.io/blog/tags/HowTo/"/>
    
    <category term="SCVMM Server" scheme="https://jpsystemcenter.github.io/blog/tags/SCVMM-Server/"/>
    
    <category term="Job" scheme="https://jpsystemcenter.github.io/blog/tags/Job/"/>
    
  </entry>
  
  <entry>
    <title>Japan System Center Enterprise Management (SCEM) チームの Blog 新規開設のお知らせ</title>
    <link href="https://jpsystemcenter.github.io/blog/general/JapanSCEM_000_NewBlogOpened/"/>
    <id>https://jpsystemcenter.github.io/blog/general/JapanSCEM_000_NewBlogOpened/</id>
    <published>2022-03-18T06:30:00.000Z</published>
    <updated>2022-08-03T07:36:22.292Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Blog-新規開設のお知らせ"><a href="#Blog-新規開設のお知らせ" class="headerlink" title="Blog 新規開設のお知らせ"></a>Blog 新規開設のお知らせ</h2><p>こんにちは、System Center Enterprise Management (SCEM) サポート チームです。<br>この度、Japan System Center Enterprise Management (SCEM) サポート チームのブログを新規に開設しましたことをお知らせいたします。</p><p>こちらのブログでは、我々のチームで扱う System Center 製品のテクノロジーに関する話題を中心に情報を発信していきます。<br>マイクロソフトでは、各製品の動作仕様や、開発部門などからも多くの公式な公開情報を提供しております。<br>このブログでは、新機能に関してのご紹介だけでなく、マイクロソフト製品をご利用のお客様よりサポート依頼を直接受けているサポート エンジニアという立場から、時には私どもの視点を交えて、皆様のお役に立つ情報をご案内したいと思います。<br>これから本ブログで公開していく情報の一例を以下に記載しました。</p><h2 id="公開する情報の例"><a href="#公開する情報の例" class="headerlink" title="公開する情報の例"></a>公開する情報の例</h2><ul><li>リリースされたばかりの新機能に関する情報</li><li>よくサポート チームにお問い合わせいただく “あるある” な問題への対処方法</li><li>System Center 製品をご利用のお客様に是非お伝えしたい情報</li><li>ある問題についてサポートにお問い合わせいただく際、スムーズに調査を進めるために事前に採取いただきたい情報</li></ul><h2 id="本ブログで扱う製品の一覧"><a href="#本ブログで扱う製品の一覧" class="headerlink" title="本ブログで扱う製品の一覧"></a>本ブログで扱う製品の一覧</h2><p>System Center に区分される製品は複数存在しますが、本ブログでは主に下記の製品についてご紹介いたします。</p><ul><li>System Center Operations Manager (SCOM)</li><li>System Center Virtual Machine Manager (SCVMM)</li><li>System Center Orchestrator (SCO, SCORCH)</li><li>System Center Service Manager (SCSM)</li></ul><p>これら以外の System Center 製品、例えば Data Protection Manager (SCDPM) や Configuration Manager (SCCM) は本ブログにて扱う予定はございませんので、予めご了承くださいませ。<br>これから様々な情報を発信しますので、こちらのブログが皆さまのお役に立てれば幸いです。<br>また、実際のサポート サービスでは、製品動作に関する正式な見解のご提供、そして問題解決のサポートを行っていますので、こちらも併せてよろしくお願いいたします。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Blog-新規開設のお知らせ&quot;&gt;&lt;a href=&quot;#Blog-新規開設のお知らせ&quot; class=&quot;headerlink&quot; title=&quot;Blog 新規開設のお知らせ&quot;&gt;&lt;/a&gt;Blog 新規開設のお知らせ&lt;/h2&gt;&lt;p&gt;こんにちは、System Center En</summary>
      
    
    
    
    
    <category term="General" scheme="https://jpsystemcenter.github.io/blog/tags/General/"/>
    
    <category term="Information" scheme="https://jpsystemcenter.github.io/blog/tags/Information/"/>
    
  </entry>
  
  <entry>
    <title>一部の System Center 2019 で SQL Server 2019 を使用する際の前提条件</title>
    <link href="https://jpsystemcenter.github.io/blog/general/Prerequisites_SQL2019/"/>
    <id>https://jpsystemcenter.github.io/blog/general/Prerequisites_SQL2019/</id>
    <published>2022-02-16T03:00:00.000Z</published>
    <updated>2022-08-03T07:36:22.292Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆さんこんにちは、System Center サポートチームの 保科と申します。</p><p>2022 年 2 月 16 日現在、System Center 2012 の延長サポートが終了間近であったり、System Center 2016 のメインストリームサポートが終了となります。<br>これに伴い、System Center 2019 へのアップグレードや新規環境構築を検討されているお客様も多くいらっしゃるかと思います。<br>System Center 2019 で使用するデータベースでは、SQL Server 2019 の使用がサポートされております。<br>本記事では、一部の System Center 2019 で SQL Server 2019 を使用する際の注意点について説明いたします。</p><h3 id="本記事が対象とする-System-Center-製品"><a href="#本記事が対象とする-System-Center-製品" class="headerlink" title="本記事が対象とする System Center 製品"></a>本記事が対象とする System Center 製品</h3><blockquote><p>・System Center Operations Manager (SCOM) 2019<br>・System Center Service Manager (SCSM) 2019</p></blockquote><h3 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h3><p>冒頭でもお伝えしました通り、System Center 2019 では SQL Server 2019 の利用がサポートされております。<br>一方で、本記事が対象としている System Center 製品においては、インストール直後の SQL Server 2019 にデータベースを構成するようにインストールを行うと、インストールに失敗する場合があります。<br>これは、<strong>対象の System Center 2019 製品では、SQL Server 2019 に加えて、SQL Server 2019 CU8 以上の適用が必要となるため</strong>です。<br>CU8 以上の適用はインストール時に表示される前提条件では確認できず、インストール開始まで進めることが可能です。<br>この際、CU8 以上が適用されていないため内部的にエラーが発生し、System Center 2019 のインストールが失敗します。<br>こちらは、各 System Center 2019 でサポートされる構成が掲載された弊社公開情報にも CU8 以上の適用が必須なことが明記されております。<br>・SCOM 2019 における SQL Server 2019 CU8 以上の適用が必要な旨記載された弊社公開情報:<br><a href="https://docs.microsoft.com/ja-jp/system-center/scom/plan-sqlserver-design?view=sc-om-2019">https://docs.microsoft.com/ja-jp/system-center/scom/plan-sqlserver-design?view=sc-om-2019</a><br>(“SQL Server の要件” 項を参照ください。)<br>・SCSM 2019 における SQL Server 2019 CU8 以上の適用が必要な旨記載された弊社公開情報:<br><a href="https://docs.microsoft.com/ja-jp/system-center/scsm/system-requirements?view=sc-sm-2019">https://docs.microsoft.com/ja-jp/system-center/scsm/system-requirements?view=sc-sm-2019</a><br>(“SQL Server の要件” 項を参照ください。)</p><p>なお、System Center Virtual Machine Manager (SCVMM) 2019 および System Center Orchestrator (SCORCH) 2019、System Center Data Protection Manager (SCDPM) においては、SCOM 2019 および SCSM 2019 と同様に SQL Server 2019 の使用がサポートされております。<br>一方で、これらの System Center 2019 製品では CU8 以上のアップデートが SQL Server 2019 での適用が必須と明記されておりません。<br>また、実際に CU8 以上が適用されていない状態でもインストールに成功することを弊社検証環境において確認しております。</p><h3 id="対処方法"><a href="#対処方法" class="headerlink" title="対処方法"></a>対処方法</h3><p>SQL Server 2019 を対象となる System Center 2019 製品で使用する場合、SQL Server 2019 に CU8 以上の適用が必要となります。<br>各 SQL Server のバージョンで提供されている最新の CU アップデートは下記の弊社公開情報から参照いただけます。</p><ul><li>アプリケーションとそのコンポーネントのバージョン、エディション、および更新SQL Server決定する<br><a href="https://docs.microsoft.com/ja-jp/troubleshoot/sql/general/determine-version-edition-update-level">https://docs.microsoft.com/ja-jp/troubleshoot/sql/general/determine-version-edition-update-level</a></li></ul><p>SQL Server 2019 の最新版の CU アップデートを入手される場合、こちらの公開情報より “現在サポートされているバージョンの更新プログラムで利用可能な最新SQL Server” 項の表を参照します。<br>“バージョン” 列が “SQL Server 2019” と記載された行の “最新の累積的な更新プログラム” より、”CU <strong>xx</strong> for 2019” と書かれた文字をクリックすることで、対象の CU アップデートの内容およびダウンロード先が掲載された弊社サイトが開かれます。<br>( <strong>xx</strong> には、CU アップデートの数値が記載されております。<br>2022 年 2 月 16 日現在、こちらは “CU15 for 2019” と記載されております。)<br>開かれたサイトより最新版の CU アップデートをダウンロードいただけるリンクをクリックし、アップデートファイルを入手します。<br>そのアップデートファイルを System Center 2019 製品で使用する SQL Server 上で適用することでアップデートが完了します。<br>アップデート後、System Center 2019 のインストールが行えるかご確認ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆さんこんにちは、System Center サポートチームの 保科と申します。&lt;/p&gt;
&lt;p&gt;2022 年 2 月 16 日現在、System Center 2012 の延長サポートが終了間近であったり、System Cen</summary>
      
    
    
    
    
    <category term="HowTo" scheme="https://jpsystemcenter.github.io/blog/tags/HowTo/"/>
    
    <category term="General" scheme="https://jpsystemcenter.github.io/blog/tags/General/"/>
    
    <category term="SQL Server" scheme="https://jpsystemcenter.github.io/blog/tags/SQL-Server/"/>
    
  </entry>
  
  <entry>
    <title>SCOM 2012 R2 エージェントのアンインストール時のトラブル事例</title>
    <link href="https://jpsystemcenter.github.io/blog/SCOM/SCOM_2012R2_Uninstall-TroubleCase/"/>
    <id>https://jpsystemcenter.github.io/blog/SCOM/SCOM_2012R2_Uninstall-TroubleCase/</id>
    <published>2022-02-04T03:00:00.000Z</published>
    <updated>2022-08-03T07:36:22.288Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは、System Center サポートチームの 佐藤 です。</p><p>本日は System Center Operations Manager（以後 SCOM）のエージェントの入れ替え作業の失敗事例をご紹介いたします。<br>2022 年 1 月現在の状況として、（<a href="https://docs.microsoft.com/ja-jp/lifecycle/products/microsoft-system-center-2012-r2-operations-manager">SCOM 2012 R2の延長サポートのフェーズが2022年7月に終了</a>）することに伴い、SCOM 2016や2019 など後継バージョンの環境を新規構築して移行を進めている、もしくはご計画されているお客様もいるかと存じます。</p><p>その際、監視対象コンピューターにて <strong>SCOM 2012 R2 のエージェントのアンインストールを行う事となりますが、アンインストール時に想定外に発生したトラブル事例</strong>についてご紹介いたします。</p><p>アンインストールした際には下記パスのように SCOM エージェント専用のフォルダやフォルダ配下のファイルが削除されるのは当然ですが、その他に別ソフトウェアでも使用するファイルが配置しているフォルダにある SCOM エージェント で使用するファイルも削除する対象となります。</p><blockquote><p>例）<br>SCOM エージェント専用のフォルダの例<br>　C:\Program Files\Microsoft Monitoring Agent\Agent<br>別ソフトウェアでも使用するファイルが配置しているフォルダの例<br>　C:\Windows\System32</p><p>上記例に記載しているフォルダ「C:\Windows\System32」からは以下ファイルが削除対象となります。<br>　AcsMsgs.dll<br>　AdtAgent.exe<br>　InterceptCounters.dll<br>　msvcp100.dll<br>　msvcr100.dll</p></blockquote><p>通常他ソフトウェアで上記ファイルを使用している場合は Windows のレジストリの設定値（複数のプログラムで使用しているため、アンインストールしない設定）によりアンインストール時に削除されないようになっているはずが、その設定がされておらず想定外にファイル msvcp100.dll が削除される事例がございました。</p><h4 id="■レジストリ設定個所"><a href="#■レジストリ設定個所" class="headerlink" title="■レジストリ設定個所"></a>■レジストリ設定個所</h4><blockquote><p>　HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\SharedDLLs</p></blockquote><p>当事象は基本発生しないはずですが、万一発生してしまった場合は削除されたファイルを再度インストールする事で基本は復旧いたします。<br>必要なファイルについては各ソフトウェア次第でございますので、ここでのご説明は省略させていただきますが、上記ファイル msvcp100.dll の例でしたら当ファイル含むランタイム一式を下記サイトから取得いただき、再度インストールいただく事で復旧いたしました。<br>x86 と x64 については、今回消失してしまったモジュールにあわせて選択していただく必要がありますのでご留意ください。<br><a href="https://www.microsoft.com/ja-jp/download/details.aspx?id=26999">https://www.microsoft.com/ja-jp/download/details.aspx?id=26999</a> </p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは、System Center サポートチームの 佐藤 です。&lt;/p&gt;
&lt;p&gt;本日は System Center Operations Manager（以後 SCOM）のエージェントの入れ替え作業の失敗事例をご紹介</summary>
      
    
    
    
    
    <category term="SCOM" scheme="https://jpsystemcenter.github.io/blog/tags/SCOM/"/>
    
    <category term="Troubleshoot" scheme="https://jpsystemcenter.github.io/blog/tags/Troubleshoot/"/>
    
    <category term="Agent" scheme="https://jpsystemcenter.github.io/blog/tags/Agent/"/>
    
  </entry>
  
  <entry>
    <title>SCOM エージェントの入れ替え作業の失敗事例</title>
    <link href="https://jpsystemcenter.github.io/blog/SCOM/SCOM_agent_failures/"/>
    <id>https://jpsystemcenter.github.io/blog/SCOM/SCOM_agent_failures/</id>
    <published>2022-01-28T03:00:00.000Z</published>
    <updated>2022-08-03T07:36:22.288Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは、System Center サポートチームの 佐藤 です。</p><p>本日は System Center Operations Manager（以後 SCOM）  のエージェントの入れ替え作業の失敗事例をご紹介いたします。<br>2022 年 1 月現在の状況として、（<a href="https://docs.microsoft.com/ja-jp/lifecycle/products/microsoft-system-center-2012-r2-operations-manager">SCOM 2012 R2の延長サポートのフェーズが2022年7月に終了</a>）することに伴い、SCOM 2016や2019 など後継バージョンの環境を新規構築して移行を進めている、もしくはご計画されているお客様もいるかと存じます。</p><p>その際、監視対象コンピューターにて SCOM 2012 R2 のエージェントのアンインストールを行い、SCOM 2016 や 2019 のエージェントをインストールすることになりますが、<strong>アンインストール時に想定通り削除が出来ず、SCOM 2012 R2 向けのレジストリ設定やフォルダが残存してしまい SCOM エージェントをインストールする際に失敗する事例</strong>が発生しております。</p><h2 id="Error-Message"><a href="#Error-Message" class="headerlink" title="Error Message"></a>Error Message</h2><p>具体的にはプッシュインストール時には下記のようなインストール失敗メッセージが出力されます</p><blockquote><p>リモート コンピューター &lt;&lt;コンピューターFQDN&gt;&gt; のエージェント管理オペレーションは エージェントのインストール に失敗しました。<br>インストール アカウント: XXX<br>エラー コード: 80070643<br>エラーの説明: インストール中に致命的なエラーが発生しました。<br>Microsoft インストーラーのエラーの説明:<br>詳細については、管理サーバーの Windows インストーラーのログ ファイル “C:\Program Files\Microsoft System Center 2016\Operations &gt;Manager\Server\AgentManagement\AgentLogs\xxxAgentInstall.LOG<br>C:\Program Files\Microsoft System Center 2016\Operations Manager\Server\AgentManagement\AgentLogs\XXXMOMAgentMgmt.log” を参照してください。 </p></blockquote><h2 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h2><p>当事象が発生した際には<br>下記に記載するフォルダとレジストリを確認いただき、残存している場合は削除いただきますようお願いします。</p><p>※下記 2 つの値は環境によりで異なっております。</p><blockquote><p>D996D247BE65CC940AA413D70EF113DC<br>742D699D-56EB-49CC-A04A-317DE01F31CD</p></blockquote><p>以下のように確認いただき、お客様環境の文字列に読み替えをお願いします。</p><p>・D996D247BE65CC940AA413D70EF113DC<br>パス「HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\S-1-5-18\Products」において<br>下図のように [InstallProperties] の [DisplayName] が “Microsoft Monitoring Agent”となっている箇所の フォルダ名</p><p>下図の確認結果として ”D996D247BE65CC940AA413D70EF113DC” を ”5C0796876F6E14A42B83EA524D9BE1AE” に読み替えます。<br><img src="https://user-images.githubusercontent.com/71251920/151289630-3ed34906-47a7-467f-ac70-4bf269148ce7.gif" alt="SCOM_agent_failures_01"></p><p>・742D699D-56EB-49CC-A04A-317DE01F31CD<br>パス「HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\」において<br>下図のように [DisplayName] が “Microsoft Monitoring Agent”となっている箇所の フォルダ名</p><p>下図の確認結果として ”742D699D-56EB-49CC-A04A-317DE01F31CD” を”786970C5-E6F6-4A41-B238-AE25D4B91EEA” に読み替えます。<br><img src="https://user-images.githubusercontent.com/71251920/151289631-00aa5d7c-8b20-4bf3-baca-4baefd861d66.gif" alt="SCOM_agent_failures_02"></p><h3 id="削除対象のレジストリ"><a href="#削除対象のレジストリ" class="headerlink" title="削除対象のレジストリ"></a>削除対象のレジストリ</h3><p>・全てフォルダとなります。keyではございません。<br>・2行目の[XXXX\C96403E8AD6025B4F9E1FE9C574E34AE]は固定文字列のフォルダとなります。</p><p>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\S-1-5-18\Products\D996D247BE65CC940AA413D70EF113DC<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UpgradeCodes\C96403E8AD6025B4F9E1FE9C574E34AE<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\S-1-5-18\Components\D9960A263C3B3F948AE9C9793043B7C9<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall{742D699D-56EB-49CC-A04A-317DE01F31CD}<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\System Center<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\System Center Operations Manager<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft Operations Manager<br>HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Installer\Products\D996D247BE65CC940AA413D70EF113DC<br>HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Installer\Features\D996D247BE65CC940AA413D70EF113DC<br>HKEY_LOCAL_MACHINE\SOFTWARE\Classes\Installer\UpgradeCodes\C96403E8AD6025B4F9E1FE9C574E34AE<br>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\MOMConnector<br>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\HealthService<br>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\System Center Management APM</p><h3 id="削除対象のフォルダ"><a href="#削除対象のフォルダ" class="headerlink" title="削除対象のフォルダ"></a>削除対象のフォルダ</h3><p>C:\Windows\Installer{742D699D-56EB-49CC-A04A-317DE01F31CD}<br>C:\Program Files\Common Files\Microsoft Shared\Operations Manager</p><p>上記レジストリ及びフォルダの確認、削除が完了しましたらここで OS の再起動をお願いします。</p><p>確認および削除手順は以上となります。新規エージェントをインストールする際に失敗する事象が発生した際は、ぜひ一度上記確認をお願いいたします。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは、System Center サポートチームの 佐藤 です。&lt;/p&gt;
&lt;p&gt;本日は System Center Operations Manager（以後 SCOM）  のエージェントの入れ替え作業の失敗事例をご</summary>
      
    
    
    
    
    <category term="SCOM" scheme="https://jpsystemcenter.github.io/blog/tags/SCOM/"/>
    
    <category term="Troubleshoot" scheme="https://jpsystemcenter.github.io/blog/tags/Troubleshoot/"/>
    
    <category term="Agent" scheme="https://jpsystemcenter.github.io/blog/tags/Agent/"/>
    
  </entry>
  
  <entry>
    <title>SCVMM サーバーおよび SCVMM 管理対象サーバーの自己署名証明書の更新手順</title>
    <link href="https://jpsystemcenter.github.io/blog/SCVMM/SCVMM_Renew_Crtificate/"/>
    <id>https://jpsystemcenter.github.io/blog/SCVMM/SCVMM_Renew_Crtificate/</id>
    <published>2022-01-12T03:00:00.000Z</published>
    <updated>2022-08-03T07:36:22.292Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆さんこんにちは、System Center サポートチームの 保科と申します。</p><p>今回は、System Center Virtual Machine Manager (SCVMM) で使用する自己署名証明書の有効期限が切れた場合や、削除をされた場合の対処方法についてご案内いたします。</p><h3 id="本ページが対象とする-SCVMM-バージョン"><a href="#本ページが対象とする-SCVMM-バージョン" class="headerlink" title="[本ページが対象とする SCVMM バージョン]"></a>[本ページが対象とする SCVMM バージョン]</h3><p>SCVMM 2012<br>SCVMM 2012 SP1<br>SCVMM 2012 R2<br>SCVMM 2016<br>SCVMM 2019</p><h3 id="概要"><a href="#概要" class="headerlink" title="[概要]"></a>[概要]</h3><p>SCVMM では、SCVMM サーバー機能をインストールしたサーバーや、SCVMM にて管理対象となる Hyper-V サーバーに SCVMM エージェントがインストールされた際、同時に自己署名証明書も当該サーバーにインストールされます。<br>これは、SCVMM サーバーと管理対象 Hyper-V サーバーの間の通信の安全性を確保するためにインストールされます。<br>そのため、この自己署名証明書は、SCVMM サーバーが管理対象 Hyper-V サーバーと通信を行う際に必須となる証明書となります。</p><p>この自己署名証明書は、フレンドリ名が  “SCVMM_CERTIFICATE_KEY_CONTAINER***” となっており、発行者はそのホスト自身になっています。<br>(*** の部分は SCVMM サーバーもしくは Hyper-V サーバーの完全修飾ドメイン名となります。)<br>この証明書の期限は SCVMM サーバーや、Hyper-V サーバーを SCVMM の管理対象に設定した年の 1/1 から 5 年間に設定されます。<br>例えば 2015/10/26 に Hyper-V ホストを SCVMM の管理対象に設定した場合、設定される証明書の有効期限は 2020/1/1 になります。<br>これは 2015 年中であればいつ Hyper-Vホストを管理対象に追加された場合でも同様の結果となります。</p><p>上記の通りこの証明書の期限は 5 年間 (SCVMM のバージョンによっては 10 年間)となっています。<br>このため、5 年間 (10 年間) が経過するとこの証明書は無効になります。<br>なお、この証明書の有効期限が超過する 1 ヶ月前になりますと、SCVMM サーバー上で以下の警告メッセージが出力されるようになります。</p><blockquote><p>警告 (20583)<br>コンピューター &lt;対象サーバーの完全修飾ドメイン名&gt; の自己署名証明書は既に有効期限切れか、1 か月以内に有効期限切れになります。</p><p>推奨される操作<br>VMM から &lt;対象サーバーの完全修飾ドメイン名&gt; を削除してから追加して、新しい証明書を取得してください。</p></blockquote><p>また何かのトラブルシュートの際などに誤ってこの証明書を削除してしまったりすることも考えられます。<br>その場合、SCVMM サーバーと Hyper-V サーバーの間の通信に問題が発生し、Hyper-V サーバーの管理作業などが正しく動作しなくなります。</p><p>このような場合、SCVMM サーバーもしくは Hyper-V サーバーにインストールされている SCVMM エージェントを再インストールすることで対処することもできますが、証明書を再発行することでも対処することができます。<br>この際の手順は以下の [対処手順 ①] に従って自己署名証明書の再インストールを実施します。<br>また、SCVMM サーバー限定かつ特定の SCVMM バージョン限定の手順とはなりますが、[対処手順 ②] に従った自己署名証明書の更新も実施いただけます。</p><h3 id="対処手順-①"><a href="#対処手順-①" class="headerlink" title="[対処手順 ①]"></a>[対処手順 ①]</h3><ol><li>自己署名証明書を更新いただくサーバーに管理者権限でログインします。</li><li>Windows + R を入力して、[ファイル名を指定して実行] を起動します。</li><li>mmc と入力して [OK] をクリックします。</li><li>表示されたウインドウで、メニュー バーから [ファイル] - [スナップインの追加と削除] を選択します。</li><li>“利用できるスナップイン” から “証明書” を選択し、[追加] をクリックします。</li><li>[証明書スナップイン] ウインドウが表示されたら、”コンピューター アカウント” をチェックし、[次へ] をクリックします。</li><li>[コンピューターの選択] ウインドウでは、既定値のまま [完了] をクリックします。</li><li>[OK] をクリックして、[スナップインの追加と削除] ウインドウを閉じます。</li><li>左側のツリーから、[証明書 (ローカル コンピューター)] -&gt; [個人] -&gt; [証明書] を開きます。</li><li>中央ペインに表示されている証明書のうち、”フレンドリ名” 列に “SCVMM_CERTIFICATE_KEY_CONTAINER***” と表示されてる証明書を選択して削除します。<br>(*** の部分は SCVMM サーバーもしくは Hyper-V サーバーの完全修飾ドメイン名となります。)<br>そのような証明書が既に存在しない場合、そのまま手順 11. に進みます。</li><li>SCVMM サーバー上で、”Virtual Machine Manager Command Shell” を起動します。</li><li>以下のコマンドを実行します。<blockquote><p><code> </code> <code>$credential = get-credential</code> <code> </code></p></blockquote></li><li>表示されたウインドウに、SCVMM サーバーのローカル管理者権限のあるユーザーのユーザー名とパスワードを入力して [OK] をクリックします。</li><li>続いて、以下のコマンドを実行します。<br>(*** の部分は SCVMM サーバーもしくは Hyper-V サーバーの完全修飾ドメイン名を入力します。)<blockquote><p><code> </code> <code>Get-VMMManagedComputer -ComputerName &quot;***&quot; | Register-SCVMMManagedComputer  -Credential $credential</code> <code> </code></p></blockquote></li><li>自己署名証明書を更新されるサーバーに、有効期限が 5 年後 (10 年後) の 1 月 1 日に設定された自己署名証明書が無事再作成されたことを、10. の手順で開いたコンソール上で確認いただきます。<br>手順実施後も証明書が更新されていない場合、画面を最新の情報に更新いただくことで表示される場合がございます。</li></ol><h3 id="対処手順-②"><a href="#対処手順-②" class="headerlink" title="[対処手順 ②]"></a>[対処手順 ②]</h3><p>こちらの手順は、以下の SCVMM バージョンにて追加されたコマンドレットを使用する手順となります。<br>・SCVMM 2016 Update Rollup 10<br>・SCVMM 2019 Update Rollup 2<br>上記のバージョンに SCVMM をアップデートすると、SCVMM サーバーの自己署名証明書を更新する “Update-SCVMMCertificate” コマンドレットがご利用いただけるようになります。<br>SCVMM サーバー限定の手順となり、Hyper-V サーバーに対しては実施いただけない手順となりますが、以下の手順に沿って SCVMM サーバーにインストールされた自己署名証明書を更新いただけます。</p><ol><li>SCVMM サーバーに管理者権限でログインします。</li><li>ログインしたサーバー上で “Virtual Machine Manager Command Shell” を起動します。</li><li>以下のコマンドを実行します。<blockquote><p><code> </code> <code>Update-SCVMMCertificate -VMMServer &#39;***&#39; </code> <code> </code><br><code> </code> <code> (*** の部分は SCVMM サーバーの完全修飾ドメイン名を入力します。)</code> <code> </code></p></blockquote></li><li>自己署名証明書を更新されるサーバーに、有効期限が 5 年後 (10 年後) の 1 月 1 日に設定された自己署名証明書が無事再作成されたことを、”対処手順 ①” の 10. の手順で開けるコンソール上で確認いただきます。<br>手順実施後も証明書が更新されていない場合、画面を最新の情報に更新いただくことで表示される場合がございます。</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆さんこんにちは、System Center サポートチームの 保科と申します。&lt;/p&gt;
&lt;p&gt;今回は、System Center Virtual Machine Manager (SCVMM) で使用する自己署名証明書の有効</summary>
      
    
    
    
    
    <category term="Agent" scheme="https://jpsystemcenter.github.io/blog/tags/Agent/"/>
    
    <category term="SCVMM" scheme="https://jpsystemcenter.github.io/blog/tags/SCVMM/"/>
    
    <category term="HowTo" scheme="https://jpsystemcenter.github.io/blog/tags/HowTo/"/>
    
    <category term="Library Server" scheme="https://jpsystemcenter.github.io/blog/tags/Library-Server/"/>
    
  </entry>
  
  <entry>
    <title>AdtAdmin / setquery でアクセス拒否エラー(0x00000005)が発生する場合の対処法</title>
    <link href="https://jpsystemcenter.github.io/blog/SCOM/SCOM_AccessError_0x00000005/"/>
    <id>https://jpsystemcenter.github.io/blog/SCOM/SCOM_AccessError_0x00000005/</id>
    <published>2022-01-06T03:00:00.000Z</published>
    <updated>2022-08-03T07:36:22.288Z</updated>
    
    <content type="html"><![CDATA[<span id="more"></span><p>皆様こんにちは、System Center サポートチームの 佐藤 です。</p><p>本日は System Center Operations Manager（以後 SCOM） の機能である 監査コレクション サービス (ACS) （<a href="https://docs.microsoft.com/ja-jp/system-center/scom/deploy-install-acs?view=sc-om-2019">監査コレクション サービス (ACS) コレクターとデータベースをインストールする方法 | Microsoft Docs</a>）において WQL クエリ設定を実行する際に必要な設定をご紹介いたします。</p><p>ACS は WQL（<a href="https://docs.microsoft.com/ja-jp/sql/relational-databases/wmi-provider-server-events/using-wql-with-the-wmi-provider-for-server-events?view=sql-server-ver15">WMI Provider for Server Events と WQL の使用 - SQL Server | Microsoft Docs</a>）を使用して取得対象のイベントの範囲を絞ることが可能です。<br>これは ACS データを保存するデータベースの肥大化の防止、また不要なデータを取得しないことでSCOM 管理サーバー/監視対象サーバーの処理負荷の軽減に寄与いたします。</p><p>しかし、規定の設定では下記のように WQL を実行しようとする際にアクセス拒否エラーが出力される事が確認されております。</p><blockquote><p>■コマンド例<br><code> </code> <code>C:\Windows\System32\Security\AdtServer&gt;AdtAdmin /setquery /query:&quot;SELECT * FROM AdtsEvent WHERE EventId=XXX&quot; </code> <code> </code></p></blockquote><p>その際はレジストリエディタにて以下キーに対してユーザー “NETWORK SERVICE” へ フルコントールなどの “値の設定”の権限付与することで改善されます。<br>こちらの設定については SCOM 用に定義されているパラーメータ設定であり、設定変更により他アプリケーションへの影響はございませんのでご安心ください。</p><blockquote><p>■キー<br><code> </code> <code>HKLM\SYSTEM\CurrentControlSet\Services\AdtServer\Parameters</code> <code> </code></p></blockquote><p>参考図：</p><p><img src="https://user-images.githubusercontent.com/71251920/148327138-6c2ba2db-ced8-4408-9c43-144a170ee18d.png" alt="参考図"></p><blockquote><p>対象バージョン：<br>　System Center Operations Manager 2012 R2<br>　System Center Operations Manager 2016<br>　System Center Operations Manager 2019</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;span id=&quot;more&quot;&gt;&lt;/span&gt;
&lt;p&gt;皆様こんにちは、System Center サポートチームの 佐藤 です。&lt;/p&gt;
&lt;p&gt;本日は System Center Operations Manager（以後 SCOM） の機能である 監査コレクション サービス (</summary>
      
    
    
    
    
    <category term="SCOM" scheme="https://jpsystemcenter.github.io/blog/tags/SCOM/"/>
    
    <category term="Troubleshoot" scheme="https://jpsystemcenter.github.io/blog/tags/Troubleshoot/"/>
    
    <category term="Audit Collection Service (ACS)" scheme="https://jpsystemcenter.github.io/blog/tags/Audit-Collection-Service-ACS/"/>
    
  </entry>
  
</feed>
